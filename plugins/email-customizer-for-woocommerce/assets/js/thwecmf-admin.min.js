var thwecmf_settings=function($,window,document){"use strict";new Array("configure","layouts","layout-element","settings");var BLOCK_DRAGG,BUILDER_ROWS=new Array("one_column","two_column"),BUILDER_COLS=new Array("one_column_one","two_column_one","two_column_two"),BUILDER_HOOKS=new Array("email_header","email_order_details","before_order_table","after_order_table","order_meta","customer_details","email_footer","downloadable_product"),ADDRESS_BLOCKS=new Array("billing_address","shipping_address"),COL_TO_NUM={one_column:1,two_column:2,three_column:3,four_column:4},NUM_TO_WORDS={1:"one",2:"two",3:"three",4:"four"},UPLOAD_FILE_TYPES=new Array("image/jpeg","image/png","image/jpg"),TB_DEFAULT='{"b_t":"1px","b_r":"1px","b_b":"1px","b_l":"1px","border_style":"solid","border_color":"#dedede","bg_color":"#ffffff"}',LAYOUT_HELPER={},EMPTY_TD_DATA='<span class="thwecmf-builder-add-btn thwecmf-btn-add-element">+ Add Element</span>',DEF_COL_PROPS={width:"50%",p_t:"10px",p_r:"10px",p_b:"10px",p_l:"10px",b_t:"1px",b_r:"1px",b_b:"1px",b_l:"1px",border_style:"dotted",border_color:"#dddddd",bg_color:"none",text_align:"center"},TEST_MAIL_NOTICE="<span>Please enter a valid email id</span>",IMG_CONTENT_BLOCKS=(new Array("img_size_width","img_size_height"),new Array("header_details","image","gif","social"));function remove_builder_panel_highlights(){$("#thwecmf-sidebar-configure .thwecmf-builder-elm-layers").find(".thwecmf-panel-highlight").removeClass("thwecmf-panel-highlight"),$("#tbf_t_builder").find(".thwecmf-builder-highlight").removeClass("thwecmf-builder-highlight")}function prepare_validation_html(message,valid){var html="";return html+='<p class="'+(valid?"thwecmf-validation-success":"thwecmf-validation-failed")+'">'+message+"</p>"}function prepare_page_reload_event(){var builder_obj=$("#tbf_t_builder"),block_length=builder_obj.find(".thwecmf-builder-block").length,data_track=builder_obj.attr("data-track-save"),data_global=builder_obj.attr("data-global-id"),data_css=builder_obj.attr("data-css-change");if(0<builder_obj.length&&0<block_length&&data_track!=data_global)event.returnValue="o/";else{if("false"!=data_css)return;event.returnValue="o/"}}function setup_sidebar_scrolls(active_tab1){active_tab1=active_tab1||$("#thwecmf-sidebar-configure.thwecmf-active-tab");var height1=$("#thwecmf-sidebar-element-wrapper").height()-55;active_tab1.find(".thwecmf-layers-outer-wrapper").css({height:height1})}function setup_sidebar_panel_scrolls(active_tab2,layout_wrapper,edit_wrapper,element_wrapper){active_tab2=active_tab2||$("#thwecmf-sidebar-settings.thwecmf-active-tab");var sidebar_wrapper=$("#thwecmf-sidebar-element-wrapper"),height2=sidebar_wrapper.height()-4,height3=sidebar_wrapper.height()-4;layout_wrapper&&active_tab2.find(".wecmf-layout-panel-outer-wrapper").css({height:height2}),edit_wrapper&&active_tab2.find(".thwecmf_field_form_outer_wrapper").css({height:height3}),element_wrapper&&active_tab2.find(".outer-wrapper").css({height:height2})}function setup_colorpick_preview(form){form.find(".thpladmin-colorpick").each(function(){$(this).parent().find(".thpladmin-colorpickpreview").css({backgroundColor:this.value})})}function get_field_value(form,type,name){var value="";switch(type){case"select":value=null==(value=form.find("select[name=i_"+name+"]").val())?"":value;break;case"checkbox":value=(value=form.find("input[name=i_"+name+"]").prop("checked"))?1:0;break;case"textarea":value=null==(value=form.find("textarea[name=i_"+name+"]").val())?"":value;break;default:value=null==(value=form.find("input[name=i_"+name+"]").val())?"":value}return value}function set_field_value(form,type,name,value,multiple){switch(type){case"select":1==multiple&&"string"==typeof value&&(value=value.split(","),name+="[]"),form.find('select[name="i_'+name+'"]').val(value);break;case"checkbox":value=1==value,form.find("input[name=i_"+name+"]").prop("checked",value);break;case"textarea":form.find("textarea[name=i_"+name+"]").val(value);break;default:form.find("input[name=i_"+name+"]").val(value)}}function thwecmfEscapeHTML(html){return html.replace(/[&<>"]/g,function(tag){return{'"':"&quot;","'":"&#39;"}[tag]||tag})}function thwecmf_sanitize_field(string){return $($.parseHTML(string)).text()}$("#thwecmf_tbuilder_editor_preview"),$("#thwecmf-sidebar-settings").on("click",".thwecmf-elm-col",function(event){var form=$("#thwecmf_tbuilder_layout_elm_form");reset_sidebar_status("thwecmf-sidebar-configure");var block_identifier=get_field_value(form,"hidden","thwecmf_block_id"),col_count=get_field_value(form,"hidden","thwecmf_col_count"),block_identifier=block_identifier||"";!function(blockName,blockId,col_count){var new_id=generate_rand_string(),track_html=function(blockName,row_id){if(is_row(blockName)){var html='<div id="'+row_id+'" class="thwecmf-rows thwecmf-panel-builder-block" data-columns="'+COL_TO_NUM[blockName]+'">';LAYOUT_HELPER.row="tbf_"+row_id,html=(html=(html=(html+=$("#thwecmf_tracking_panel_row_html").html()).replace("{bl_id}",row_id)).replace("{bl_name}",blockName)).replace('data-icon-attr="{bl_name}"','data-icon-attr="'+blockName+'"'),html+='<div class="thwecmf-column-set">';for(var i=1;i<=COL_TO_NUM[blockName];i++){var column_id=generate_rand_string();LAYOUT_HELPER["column_"+i]="tbf_"+column_id,html+=function(row_id,column_id,blockName,i){var column_name=blockName+"_"+NUM_TO_WORDS[i];is_column(column_name)||(column_name="column_clone");var t_html='<div id="'+column_id+'" class="thwecmf-columns thwecmf-panel-builder-block" data-parent="'+row_id+'">';return t_html=(t_html=(t_html=(t_html+=$("#thwecmf_tracking_panel_col_html").html()).replace("{bl_id}",column_id)).replace("{bl_name}",column_name)).replace('data-icon-attr="{bl_name}"','data-icon-attr="'+column_name+'"'),t_html+='<div class="thwecmf-element-set">',t_html+='<div class="thwecmf-hidden-sortable thwecmf-elements"></div><div class="thwecmf-btn-add-element panel-add-btn panel-add-element"><a href="#">Add Element</a></div>',t_html+="</div></div>"}(row_id,column_id,blockName,i)}html+='<div class="btn-add-column-wrap">',html+='<div class="panel-add-btn btn-add-column thwecmf-premium-disabled-feature" data-parent="'+row_id+'">',html+="<a>Add Column</a></div>",html+='<span class="th-premium-feature-msg th-premium-feature-msg-add-column">Upgrade</span>',html+="</div></div>"}else{!function(name){return-1!==$.inArray(name,BUILDER_HOOKS)}(blockName)?(html='<div id="'+row_id+'" class="thwecmf-elements thwecmf-panel-builder-block">',html=(html=(html=(html=(html+=$("#thwecmf_tracking_panel_elm_html").html()).replace("{name}",clean_block_name(blockName))).replace("{bl_id}",row_id)).replace("{bl_name}",blockName)).replace("{bl_attr_name}",blockName.toLowerCase()),html+="</div>;",LAYOUT_HELPER.element="tbf_"+row_id):(clean_block_name(blockName),html='<div id="'+row_id+'" class="thwecmf-hooks thwecmf-panel-builder-block">',html=(html+=$("#thwecmf_tracking_panel_hook_html").html()).replace("{name}",clean_block_name(blockName)),html+="</div>",LAYOUT_HELPER.hook="tbf_"+row_id)}return html}(blockName,new_id);(function(builder_html,track_html,blockId){{var id,target;blockId?(id="tbf_"+blockId,$(track_html).insertBefore($("div.thwecmf-builder-elm-layers").find("#"+blockId+" > .thwecmf-element-set > div.panel-add-element")),0<(target=$("#tbf_t_builder").find("#"+id)).find(">.thwecmf-btn-add-element").length&&target.find(">.thwecmf-btn-add-element").remove(),target.append(builder_html)):($("div.thwecmf-builder-elm-layers").append(track_html),$("#tbf_t_builder .thwecmf-builder-column").append(builder_html))}})(function(blockName,col_count){var block_elm="",elm_type="";"one_column"==blockName?(block_elm=$("#thwecmf_template_layout_1_col"),elm_type="layout"):"two_column"==blockName?(block_elm=$("#thwecmf_template_layout_2_col"),elm_type="layout"):"billing_address"==blockName?(block_elm=$("#thwecmf_template_elm_billing_address"),elm_type="block"):"shipping_address"==blockName?(block_elm=$("#thwecmf_template_elm_shipping_address"),elm_type="block"):"text"==blockName?(block_elm=$("#thwecmf_template_elm_text"),elm_type="block"):"image"==blockName?(block_elm=$("#thwecmf_template_elm_image"),elm_type="block"):"divider"==blockName?(block_elm=$("#thwecmf_template_elm_divider"),elm_type="block"):"gap"==blockName?(block_elm=$("#thwecmf_template_elm_gap"),elm_type="block"):"email_header"==blockName?(block_elm=$("#thwecmf_template_hook_email_header"),elm_type="hook"):"email_order_details"==blockName?(block_elm=$("#thwecmf_template_hook_order_details"),elm_type="hook"):"before_order_table"==blockName?(block_elm=$("#thwecmf_template_hook_before_order_table"),elm_type="hook"):"after_order_table"==blockName?(block_elm=$("#thwecmf_template_hook_after_order_table"),elm_type="hook"):"order_meta"==blockName?(block_elm=$("#thwecmf_template_hook_order_meta"),elm_type="hook"):"customer_details"==blockName?(block_elm=$("#thwecmf_template_hook_customer_address"),elm_type="hook"):"email_footer"==blockName&&(block_elm=$("#thwecmf_template_hook_email_footer"),elm_type="hook");var block_html="";block_elm.length&&(block_html="layout"==elm_type?function(block_elm,blockName){var html=block_elm.html();html=html.replace(blockName,LAYOUT_HELPER.row);for(var i=1;i<=COL_TO_NUM[blockName];i++){var column_name="column_"+i,replace_name=blockName+"_"+i;html=html.replace(replace_name,LAYOUT_HELPER[column_name])}return LAYOUT_HELPER={},html}(block_elm,blockName):"hook"==elm_type?clean_content_element_html(block_elm,blockName,"hook"):clean_content_element_html(block_elm,blockName,"element"));return block_html}(blockName,col_count),track_html,blockId),setup_blank_sidebar_msg()}($(this).find("div").data("block-name"),block_identifier,col_count),setup_builder_ui(),setup_sidebar_scrolls(!1)}),$(".thwecmf-tbuilder-wrapper").on("click",".thwecmf-btn-add-element",function(event){event.preventDefault(),setup_sidebar_content("layout-elements");var click_elm,column_count,form=$("#thwecmf_tbuilder_layout_elm_form");$(this).hasClass("panel-add-btn")?(click_elm=$(this).closest("div.thwecmf-columns").attr("id"),column_count=$(this).closest(".thwecmf-rows.thwecmf-panel-builder-block").attr("data-columns")):$(this).hasClass("thwecmf-builder-add-btn")&&(click_elm=$(this).closest("td").attr("id").replace("tbf_",""),column_count=$(this).closest(".thwecmf-row.thwecmf-builder-block").attr("data-column-count")),set_field_value(form,"hidden","thwecmf_block_id",click_elm,0),set_field_value(form,"hidden","thwecmf_col_count",column_count,0),reset_sidebar_status(!1),$("#thwecmf-sidebar-settings").find(".thwecmf-tbuilder-elm-grid-layout-element .column-basic-elements .grid-category").removeClass("category-collapse"),setup_sidebar_panel_scrolls(!1,!1,!1,!0)}),$(".thwecmf-tbuilder-wrapper").on("click",".thwecmf-element-name,.thwecmf-hook-name",function(event){var panel_elm=$(this).closest(".thwecmf-panel-builder-block"),panel_elm_id=panel_elm.attr("id");highlight_focus_blocks($("#tbf_"+panel_elm_id),panel_elm)}),$(".thwecmf-tbuilder-wrapper").on("click",".thwecmf-aligment-icon-wrapper .img-wrapper",function(event){var icon_elm=$(this),icon_wrapper=$(this).closest(".thwecmf-aligment-icon-wrapper"),align_val=icon_elm.attr("data-align");icon_wrapper.find(".thwecmf-text-align-input").val(align_val),icon_wrapper.find(".thwecmf-text-align-input").trigger("keyup"),icon_wrapper.find(".thwecmf-active-icon").removeClass("thwecmf-active-icon"),icon_wrapper.find(".thwecmf-active-icon").removeClass("thwecmf-active-icon"),icon_elm.addClass("thwecmf-active-icon")}),$("#thwecmf-sidebar-settings").on("keyup","form :input",function(event){save_sidebar_edit_form($(this),event)}),$("#thwecmf-sidebar-settings").on("change","select",function(event){save_sidebar_edit_form($(this),event)}),$("#thwecmf_confirmation_alerts").dialog({position:{my:"center",at:"center",of:$("#thwecmf-sidebar-element-wrapper")},draggable:!0,appendTo:"#thwecmf-sidebar-element-wrapper",modal:!0,width:275,resizable:!1,autoOpen:!1,dialogClass:"thwecmf-confirmations",buttons:[{text:"No",click:function(){$(this).dialog("close")}},{text:"Yes",click:function(){var tb_builder;(tb_builder=$("#tbf_t_builder")).find(".thwecmf-builder-column").empty(),$("div.thwecmf-builder-elm-layers").empty(),setup_blank_sidebar_msg(),tb_builder.attr("data-css-props",TB_DEFAULT),tb_builder.attr("data-global-id","1000"),tb_builder.attr("data-track-save","1000"),$("#thwecmf_template_css_override").html(""),$("#thwecmf_template_css_preview_override").html(""),$(this).dialog("close")}}]}).parent().draggable({containment:"#dialogContainer"}),setup_builder_ui(),setup_sidebar_scrolls(),$(window).on("resize",function(){var active_tab1=$("#thwecmf-sidebar-configure.thwecmf-active-tab"),active_tab2=$("#thwecmf-sidebar-settings.thwecmf-active-tab");0<active_tab1.length?setup_sidebar_scrolls(active_tab1):0<active_tab2.length&&setup_sidebar_panel_scrolls(active_tab2,!0,!0,!0)}),window.addEventListener("beforeunload",function(event){prepare_page_reload_event()}),$("#delete_template").click(function(event){""==get_field_value($("#thwecmf_edit_template_form"),"select","edit_template")?(alert("Select template to delete"),event.preventDefault()):confirm("Delete the selected template ?")||event.preventDefault()}),$(".thwecmf-tbuilder-elm-wrapper").on("click",".thwecmf-column-name",function(event){$(this).closest(".thwecmf-columns").find(".thwecmf-element-set").toggle()}),$(".thwecmf-tbuilder-elm-wrapper").on("click",".thwecmf-row-name",function(event){$(this).closest(".thwecmf-rows").find(".thwecmf-column-set").toggle(),$(this).closest(".thwecmf-rows").toggleClass("rows-collpase")}),$("#wecmf_email_template_manager_table .thwecmf-template-manage-tabs").click(function(){var tab,content,select2;$(this).hasClass("thwecmf-template-manage-active")||(content="manage"==(tab=$(this).attr("data-name"))?$("#thwecmf_manage_template_table tbody").html():$("#thwecmf_map_template_table tbody").html(),$("#wecmf_email_template_manager_table > tbody").html(content),"mapping"==tab&&((select2=$("#wecmf_email_template_manager_table .thwecmf-mapping-table")).find(".thwecmf-template-map-select2.select2-hidden-accessible").select2("destroy"),select2.find(".thwecmf-template-map-select2").select2()),$("#thwecmf_template_manager").find('input[name="thwec_notification_tab"]').val(tab),$(this).siblings(".thwecmf-template-manage-active").removeClass("thwecmf-template-manage-active"),$(this).addClass("thwecmf-template-manage-active"))}),$("#tbf_t_builder").on("click",".thwecmf-block",function(event){remove_builder_panel_highlights();var builder_elm=$(this),builder_elm_id=builder_elm.attr("id");render_edit_block_sidebar_form(0,builder_elm_id.replace("tbf_",""),builder_elm.attr("data-block-name"))}),$("#wecmf_email_template_manager_table").on("click",".thwecmf-reset-link",function(event){confirm("Template will be reset to initial condition. Do you want to proceed ?")||event.preventDefault()});var BUILDER_CSS_PROPS={p_t:{name:"padding-top"},p_r:{name:"padding-right"},p_b:{name:"padding-bottom"},p_l:{name:"padding-left"},m_t:{name:"margin-top"},m_r:{name:"margin-right"},m_b:{name:"margin-bottom"},m_l:{name:"margin-left"},width:{name:"width"},height:{name:"height"},size_width:{name:"width"},size_height:{name:"height"},b_t:{name:"border-top-width"},b_r:{name:"border-right-width"},b_b:{name:"border-bottom-width"},b_l:{name:"border-left-width"},border_style:{name:"border-style"},border_color:{name:"border-color"},upload_img_url:{name:"display"},bg_color:{name:"background-color"},color:{name:"color"},font_size:{name:"font-size"},text_align:{name:"text-align"},content_align:{name:"text-align"},align:{name:"float"},img_width:{name:"width"},img_height:{name:"height"},img_size_width:{name:"width"},img_size_height:{name:"height"},details_color:{name:"color"},details_font_size:{name:"font-size"},details_text_align:{name:"text-align"},divider_height:{name:"border-top-width"},divider_color:{name:"border-top-color"},divider_style:{name:"border-top-style"}},WECMF_FREE_TEMP=new Array("customer_processing_order","customer_new_account"),EDIT_FORM_PROPS={p_t:{name:"padding_top",type:"text"},p_r:{name:"padding_right",type:"text"},p_b:{name:"padding_bottom",type:"text"},p_l:{name:"padding_left",type:"text"},m_t:{name:"margin_top",type:"text"},m_r:{name:"margin_right",type:"text"},m_b:{name:"margin_bottom",type:"text"},m_l:{name:"margin_left",type:"text"},width:{name:"width",type:"text"},height:{name:"height",type:"text"},size_width:{name:"size_width",type:"text"},size_height:{name:"size_height",type:"text"},img_size_width:{name:"img_size_width",type:"text"},img_size_height:{name:"img_size_height",type:"text"},b_t:{name:"border_width_top",type:"text"},b_r:{name:"border_width_right",type:"text"},b_b:{name:"border_width_bottom",type:"text"},b_l:{name:"border_width_left",type:"text"},border_style:{name:"border_style",type:"select"},border_color:{name:"border_color",type:"text"},bg_color:{name:"bg_color",type:"text"},upload_img_url:{name:"upload_img_url",type:"text",attribute:"yes"},content:{name:"content",type:"text",attribute:"yes"},color:{name:"color",type:"text"},font_size:{name:"font_size",type:"text"},text_align:{name:"text_align",type:"hidden"},content_align:{name:"content_align",type:"hidden"},url:{name:"url",type:"text",attribute:"yes"},title:{name:"title",type:"text",attribute:"yes"},align:{name:"align",type:"hidden"},img_width:{name:"img_width",type:"text"},img_height:{name:"img_height",type:"text"},details_color:{name:"details_color",type:"text"},details_font_size:{name:"details_font_size",type:"text"},details_text_align:{name:"details_text_align",type:"hidden"},textarea_content:{name:"textarea_content",type:"textarea",attribute:"yes"},divider_height:{name:"divider_height",type:"text"},divider_color:{name:"divider_color",type:"text"},divider_style:{name:"divider_style",type:"select"}},DEFAULT_CSS={color:"transparent","background-color":"transparent","border-color":"transparent","background-color":"transparent","padding-top":"0px","padding-right":"0px","padding-bottom":"0px","padding-left":"0px"},ELM_FORM_PROPS={border_width_top:"b_t",border_width_right:"b_r",border_width_bottom:"b_b",border_width_left:"b_l",padding_top:"p_t",padding_right:"p_r",padding_bottom:"p_b",padding_left:"p_l",margin_top:"m_t",margin_right:"m_r",margin_bottom:"m_b",margin_left:"m_l"};function generate_rand_string(){var block_id=$("#tbf_t_builder").attr("data-global-id"),new_block_id=parseInt(block_id)+1;return 0<$("#tbf_"+new_block_id).length?function generate_random_id(new_id){var new_id=parseInt(new_id)+1;0<$("#tbf_"+new_id).length?generate_random_id(new_id):$("#tbf_t_builder").attr("data-global-id",new_id)}(new_block_id):$("#tbf_t_builder").attr("data-global-id",new_block_id),new_block_id}function clean_block_name(name){return name.replace(/_/g," ").replace(/\b[a-z]/g,function(string){return string.toUpperCase()})}function is_row(name){return-1!==$.inArray(name,BUILDER_ROWS)}function is_column(name){return-1!==$.inArray(name,BUILDER_COLS)}function is_content_inlcude_img(name){return-1!==$.inArray(name,IMG_CONTENT_BLOCKS)}function highlight_focus_blocks(b_elm,p_elm){var tbuilder_ref=$("#tbf_t_builder"),panel_ref=$(".thwecmf-sidebar-config-elm-layers");tbuilder_ref.find(".thwecmf-builder-highlight").removeClass("thwecmf-builder-highlight"),panel_ref.find(".thwecmf-panel-highlight").removeClass("thwecmf-panel-highlight"),p_elm.addClass("thwecmf-panel-highlight"),b_elm.addClass("thwecmf-builder-highlight"),$("html, body").animate({scrollTop:parseInt(b_elm.offset().top)-200},500);var panel_container=$(".thwecmf-layers-outer-wrapper");panel_container.animate({scrollTop:function(elm,container){return parseInt(elm.offset().top-container.offset().top+container.scrollTop())-200}(p_elm,panel_container)},500),setTimeout(function(){p_elm.removeClass("thwecmf-panel-highlight"),b_elm.removeClass("thwecmf-builder-highlight")},3e3)}function builder_css_generator(props){var css="";return $.each(props,function(name,css_prop){var css_pname;name in BUILDER_CSS_PROPS&&(css_pname=BUILDER_CSS_PROPS[name].name,(css_prop=css_prop||DEFAULT_CSS[css_pname])&&(css+=css_pname+":"+css_prop+";"))}),css}function css_parent_selector(blockId,isPrev){var p_selector="#"+blockId;return isPrev?p_selector:p_selector+" "}function render_edit_block_sidebar_form(elm,blockId,blockName){setup_sidebar_content("settings"),function(content,blockId,blockName){var form=$("#thwecmf-sidebar-settings").find("form");is_row(blockName)?content.find(".thwecmf_field_form_general td").html($("#thwecmf_field_form_id_row").html()):is_column(blockName)?content.find(".thwecmf_field_form_general td").html($("#thwecmf_field_form_id_col").html()):content.find(".thwecmf_field_form_general td").html($("#thwecmf_field_form_id_"+blockName).html());!function(form,blockId,blockName){var ref_elem=$("#tbf_"+blockId),block_props_json=ref_elem.attr("data-css-props"),block_props=!!block_props_json&&JSON.parse(block_props_json),url_props_json=ref_elem.attr("data-text-props"),url_props=url_props_json?JSON.parse(url_props_json):"",default_upload_url=form.find(".thwecmf-upload-preview").attr("data-default-url"),def_vals=function(blockName){var default_values={};switch(blockName){case"one_column":case"two_column":default_values={p_t:"0px",p_r:"0px",p_b:"0px",p_l:"0px",m_t:"0px",m_r:"auto",m_b:"0px",m_l:"auto",b_t:"0px",b_r:"0px",b_b:"0px",b_l:"0px",bg_position:"center"};break;case"one_column_one":default_values={width:"100%",b_t:"1px",b_r:"1px",b_b:"1px",b_l:"1px",border_color:"#dddddd",border_style:"dotted"};break;case"two_column_one":case"two_column_two":default_values={width:"50%",b_t:"1px",b_r:"1px",b_b:"1px",b_l:"1px",border_color:"#dddddd",border_style:"dotted"};break;case"temp_builder":default_values={b_t:"1px",b_r:"1px",b_b:"1px",b_l:"1px",border_style:"solid",border_color:"#dedede",bg_color:"#edf1e4"};break;default:default_values=""}return default_values}(blockName);block_props&&!$.isEmptyObject(block_props)&&$.each(block_props,function(key,value){var props=EDIT_FORM_PROPS[key];EDIT_FORM_PROPS[key].attribute&&"yes"==EDIT_FORM_PROPS[key].attribute&&(value="upload_img_url"!==key||"inline-block"==value?url_props[key]:"","textarea_content"!=key&&"content"!=key||(value=url_props[key].replace(/&#39;/g,"'").replace(/&quot;/g,'"'))),"fourside"==props.type&&(props.type="text"),"upload_img_url"==key&&(value=""==value?default_upload_url:value,form.find(".thwecmf-img-preview-image .thwecmf-upload-preview img").attr("src",value),value!=default_upload_url&&form.find(".thwecmf-img-preview-"+blockName+" .thwecmf-remove-upload-btn").removeClass("thwecmf-remove-upload-inactive"),form.find(".thwecmf-img-preview-"+blockName+" .thwecmf-upload-preview img").attr("src",value)),""==value&&""!=def_vals&&key in def_vals&&(value=def_vals[key]),set_field_value(form,props.type,props.name,value,0)})}(form,blockId,blockName)}($("#thwecmf-sidebar-settings"),blockId,blockName),reset_sidebar_status(!1);var form=$("#thwecmf-sidebar-settings").find("form");set_field_value(form,"hidden","thwecmf_block_id",blockId,0),set_field_value(form,"hidden","thwecmf_block_name",blockName,0),function(form){form.find(".thpladmin-colorpick").iris({change:function(event,ui){var input=$(this);input.parent().find(".thpladmin-colorpickpreview").css({backgroundColor:ui.color.toString()}),input.val(ui.color.toString()),input.trigger("keyup")},hide:!0,border:!0}).click(function(){$(".iris-picker").hide(),$(this).closest("td").find(".iris-picker").show()}),$("body").click(function(){$(".iris-picker").hide()}),$(".thpladmin-colorpick").click(function(event){event.stopPropagation()})}(form),setup_colorpick_preview(form),$(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),function(form){form.find(".thwecmf-aligment-icon-wrapper").each(function(index,el){var icon_val=$(this).find('input[type="hidden"]').val();$(this).find(".img-wrapper[data-align='"+icon_val+"']").addClass("thwecmf-active-icon")})}(form),setup_sidebar_panel_scrolls(!1,!1,!0,!1)}function setup_blank_sidebar_msg(){$("div.thwecmf-builder-elm-layers").find(".thwecmf-rows").length<1?$(".thwecmf-empty-layer-msg").removeClass("thwecmf-layers-toggle"):$(".thwecmf-empty-layer-msg").addClass("thwecmf-layers-toggle")}function clean_content_element_html(block_elm,blockName,index){var html=(html=block_elm.html()).replace("{"+blockName+"}",LAYOUT_HELPER[index]);return LAYOUT_HELPER={},html}function setup_sidebar_content($active_tab){"configure"==$active_tab||("layout"==$active_tab?$("#thwecmf-sidebar-settings").html($("#thwecmf_builder_panel_layout").html()):"layout-elements"==$active_tab?$("#thwecmf-sidebar-settings").html($("#thwecmf_template_builder_panel_layout_element").html()):"settings"==$active_tab&&$("#thwecmf-sidebar-settings").html($("#thwecmf_builder_block_edit_form").html()))}function save_sidebar_edit_form(field,event){var form=$("#thwecmf-sidebar-settings").find("form"),key=field.attr("name").replace("i_",""),block_id=get_field_value(form,"hidden","thwecmf_block_id"),block_name=get_field_value(form,"hidden","thwecmf_block_name"),sidebar_form_valid=[],save_block=$("#tbf_"+block_id),css_props={},js_props={},data_json_css=save_block.attr("data-css-props"),data_json_text=save_block.attr("data-text-props"),data_json_text=($("#thwecmf-sidebar-element-wrapper").find(".thwecmf-upload-preview").attr("data-default-url"),data_json_text||"{}"),data_json_css=$.parseJSON(data_json_css);data_json_text=$.parseJSON(data_json_text);var data_css=$.extend({},data_json_css,data_json_text),value=function(field,type){var value="";switch(type){case"select":case"textarea":default:value=null==(value=field.val())?"":value;break;case"checkbox":value=(value=field.prop("checked"))?1:0}return value}(field,event.target.type);key in ELM_FORM_PROPS&&(key=ELM_FORM_PROPS[key]);var cleaned_textarea,display_css,css_json_props,text_json_props,align_float,message,str,arrayOfLines,formated_content,name,style_props=key in EDIT_FORM_PROPS&&EDIT_FORM_PROPS[key];if(style_props){if(key in data_css&&(void 0!==style_props.attribute?"textarea_content"==key?(cleaned_textarea=thwecmfEscapeHTML(function(html){var div=document.createElement("div");div.innerHTML=html;for(var scripts=div.getElementsByTagName("script"),i=scripts.length;i--;)scripts[i].parentNode.removeChild(scripts[i]);return div.innerHTML}(value)),data_json_text[key]=cleaned_textarea,data_json_css[key]="",js_props[key]=cleaned_textarea,css_props[key]=""):("content"==key?(js_props[key]=thwecmfEscapeHTML(thwecmf_sanitize_field(value)),css_props[key]="",data_json_text[key]=thwecmfEscapeHTML(thwecmf_sanitize_field(value)),data_json_css[key]=""):"upload_img_url"===key&&(display_css=""!==value?"inline-block":"none",js_props[key]=value,css_props[key]=display_css,data_json_text[key]=value,data_json_css[key]=display_css),js_props[key]=value):(data_json_css[key]=value,css_props[key]=value)),!$.isEmptyObject(css_props)&&key in BUILDER_CSS_PROPS){var css_prop=BUILDER_CSS_PROPS[key].name;if(!function(property,value){var div=$("<div>"),_old=div.css(property);return div.css(property,value),_old!=div.css(property)}(css_prop,""!=css_props[key]?css_props[key]:DEFAULT_CSS[css_prop]))return}0===sidebar_form_valid.length?($("#thwecmf-sidebar-settings").find("#sb_validation_msg").html(""),data_json_css&&css_props&&(css_json_props=JSON.stringify(data_json_css),save_block.attr("data-css-props",css_json_props)),!$.isEmptyObject(data_json_text)&&js_props&&(text_json_props=JSON.stringify(data_json_text),save_block.attr("data-text-props",text_json_props)),name=block_name,-1!==$.inArray(name,ADDRESS_BLOCKS)?(align_float=css_props.align,css_props.align="",$("#tbf_"+block_id).find(".thwecmf-address-alignment").attr("align",align_float)):"order_details"==block_name&&(align_float=css_props.align,$("#tbf_"+block_id).find(".order-padding").attr("align",align_float)),"text"==block_name&&"textarea_content"==key&&(js_props[key]=(str=js_props[key],arrayOfLines=str.split(/\r?\n/),formated_content="",$.each(arrayOfLines,function(index,item){formated_content+="<div class='wecmf-txt-wrap'>"+item+"<br></div>"}),formated_content)),prepare_builder_block_css(key,css_props,block_id,block_name),function(name,obj){{var img_obj,i_width,i_height,comp_size;is_content_inlcude_img(name)&&(img_obj=obj.find("img"),i_width=img_obj.width(),i_height=img_obj.height(),comp_size={c_width:i_width,c_height:i_height},img_obj.attr({width:i_width,height:i_height}),obj.attr("data-misc",JSON.stringify(comp_size)))}}(block_name,save_block),$.isEmptyObject(js_props)||function(js_props,block_id,block_name){var text_elm_class=function(block_name){var text_css={};switch(block_name){case"billing_address":text_css={content:{class:".thwecmf-billing-header",attribute:"html"}};break;case"shipping_address":text_css={content:{class:".thwecmf-shipping-header",attribute:"html"}};break;case"text":text_css={textarea_content:{class:".thwecmf-block-text-holder",attribute:"html"}};break;case"image":text_css={upload_img_url:{class:"img",attribute:"image"}};break;default:text_css=""}return text_css}((block_id="tbf_"+block_id,block_name));$.each(text_elm_class,function(name,props){var block_ref,formated_txt;(block_ref=""==props.class||(block_ref=$("#"+block_id).find(props.class)).length<1?$("#"+block_id):block_ref)&&("image"==props.attribute?block_ref.attr("src",js_props[name]):"html"==props.attribute?"text"==block_name?(formated_txt=thwecmfEscapeHTML(formated_txt=js_props[name].replace(/\r?\n/g,"<br/>")),block_ref.html(formated_txt)):block_ref.html(js_props[name]):"text"==props.attribute?block_ref.text(js_props[name]):"link"==props.attribute?block_ref.attr("href",js_props[name]):"title"==props.attribute&&block_ref.attr("title",js_props[name]))})}(js_props,block_id,block_name),setup_colorpick_preview(form)):(message="",$.each(sidebar_form_valid,function(status,msg){message+='<p class="thwecmf-msg-error">'+msg.message+"</p>"}),$("#thwecmf-sidebar-settings").find("#sb_validation_msg").html(message)),$("#tbf_t_builder").attr("data-css-change",!1)}}function prepare_builder_block_css(key,props,block_id,block_name){var tb_css_override_elm=$("#thwecmf_template_css_override"),tb_css_override=tb_css_override_elm.html();tb_css_override+=prepare_builder_css_override(key,props,"tbf_"+block_id,block_name,!0),tb_css_override_elm.html(tb_css_override);var prev_css_override_elm=$("#thwecmf_template_css_preview_override"),prev_css_override=prev_css_override_elm.html();prev_css_override+=prepare_builder_css_override(key,props,"tpf_"+block_id,block_name,!0),prev_css_override_elm.html(prev_css_override)}function prepare_builder_css_override(key,props,blockId,blockName,isPrev){var css="";switch(blockName){case"one_column":case"two_column":css=function(key,props,blockId,isPrev){var w_selector=css_parent_selector(blockId,isPrev)+".thwecmf-row",row_css="";-1!==$.inArray(key,["height","p_t","p_r","p_b","p_l","m_t","m_r","m_b","m_l","b_t","b_r","b_b","b_l","border_style","border_color","bg_color"])&&(row_css=w_selector+" {",row_css+=builder_css_generator(props),row_css+="}");return row_css}(key,props,blockId,isPrev);break;case"one_column_one":case"two_column_one":case"two_column_two":css=function(key,props,blockId,isPrev){var w_selector=css_parent_selector(blockId,isPrev)+".thwecmf-column-padding",col_css="";-1!==$.inArray(key,["width","text_align","p_t","p_r","p_b","p_l","b_t","b_r","b_b","b_l","border_style","border_color","bg_color"])&&(col_css=w_selector+"{",col_css+=builder_css_generator(props),col_css+="}");return col_css}(key,props,blockId,isPrev);break;case"text":css=function(key,props,blockId,isPrev){var w_selector=css_parent_selector(blockId,isPrev)+".thwecmf-block-text",tb_css="",td_css="",content_css="";-1!==$.inArray(key,["color","align","font_size","size_width","size_height","m_t","m_r","m_b","m_l","text_align"])&&(tb_css=w_selector+"{",tb_css+=builder_css_generator(props),tb_css+="}");-1!==$.inArray(key,["color","font_size","text_align","bg_color","b_t","b_r","b_b","b_l","border_color","border_style","p_t","p_r","p_b","p_l"])&&(td_css=w_selector+" .thwecmf-block-text-holder{",td_css+=builder_css_generator(props),td_css+="}");-1!==$.inArray(key,["color","font_size"])&&(content_css=w_selector+" *{",content_css+=builder_css_generator(props),content_css+="}");return tb_css+td_css+content_css}(key,props,blockId,blockName);break;case"billing_address":css=function(key,props,blockId,isPrev){var w_selector=css_parent_selector(blockId,isPrev)+".thwecmf-block-billing",align_css="",td_css="",header_css="",body_css="";-1!==$.inArray(key,["align"])&&(align_css=w_selector+" .thwecmf-address-alignment{",align_css+=builder_css_generator(props),align_css+="}");-1!==$.inArray(key,["size_width","size_height","bg_color","b_t","b_r","b_b","b_l","border_style","border_color","m_t","m_r","m_b","m_l"])&&(td_css=w_selector+" .thwecmf-address-wrapper-table{",td_css+=builder_css_generator(props),td_css+="}");-1!==$.inArray(key,["p_t","p_r","p_b","p_l"])&&(td_css=w_selector+" .thwecmf-billing-padding{",td_css+=builder_css_generator(props),td_css+="}");-1!==$.inArray(key,["font_size","color","text_align"])&&(header_css=w_selector+" .thwecmf-billing-header{",header_css+=builder_css_generator(props),header_css+="}");-1!==$.inArray(key,["details_font_size","details_color","details_text_align"])&&(body_css=w_selector+" .thwecmf-billing-body{",body_css+=builder_css_generator(props),body_css+="}");return align_css+""+td_css+header_css+body_css}(key,props,blockId,blockName);break;case"shipping_address":css=function(key,props,blockId,isPrev){var w_selector=css_parent_selector(blockId,isPrev)+".thwecmf-block-shipping",align_css="",td_css="",header_css="",body_css="";-1!==$.inArray(key,["align"])&&(align_css=w_selector+" .thwecmf-address-alignment{",align_css+=builder_css_generator(props),align_css+="}");-1!==$.inArray(key,["size_width","size_height","bg_color","b_t","b_r","b_b","b_l","border_style","border_color","m_t","m_r","m_b","m_l"])&&(td_css=w_selector+" .thwecmf-address-wrapper-table{",td_css+=builder_css_generator(props),td_css+="}");-1!==$.inArray(key,["p_t","p_r","p_b","p_l"])&&(td_css=w_selector+" .thwecmf-shipping-padding{",td_css+=builder_css_generator(props),td_css+="}");-1!==$.inArray(key,["font_size","color","text_align"])&&(header_css=w_selector+" .thwecmf-shipping-header{",header_css+=builder_css_generator(props),header_css+="}");-1!==$.inArray(key,["details_font_size","details_color","details_text_align"])&&(body_css=w_selector+" .thwecmf-shipping-body{",body_css+=builder_css_generator(props),body_css+="}");return align_css+""+td_css+header_css+body_css}(key,props,blockId,blockName);break;case"image":css=function(key,props,blockId,isPrev){var w_selector=css_parent_selector(blockId,isPrev)+".thwecmf-block-image",td_css="",content_css="";-1!==$.inArray(key,["content_align"])&&(td_css=w_selector+" td.thwecmf-image-column{",td_css+=builder_css_generator(props),td_css+="}");-1!==$.inArray(key,["img_size_width","img_size_height"])&&(content_css=w_selector+" td.thwecmf-image-column p{",content_css+=builder_css_generator(props),content_css+="}");return td_css+content_css}(key,props,blockId,blockName);break;case"gap":css=function(key,props,blockId,isPrev){var w_selector=css_parent_selector(blockId,isPrev)+".thwecmf-block-gap",content_css="";-1!==$.inArray(key,["height","bg_color","b_t","b_b","b_l","b_r","border_style","border_color"])&&(content_css=w_selector+"{",content_css+=builder_css_generator(props),content_css+="}");return content_css}(key,props,blockId,blockName);break;case"divider":css=function(key,props,blockId,isPrev){var w_selector=css_parent_selector(blockId,isPrev)+".thwecmf-block-divider",tb_css="",td_css="",content_css="";-1!==$.inArray(key,["m_t","m_r","m_b","m_l"])&&(tb_css=w_selector+"{",tb_css+=builder_css_generator(props),tb_css+="}");-1!==$.inArray(key,["p_t","p_r","p_b","p_l","content_align"])&&(td_css=w_selector+" td{",td_css+=builder_css_generator(props),td_css+="}");-1!==$.inArray(key,["width","divider_height","divider_color","divider_style"])&&(content_css=w_selector+" td hr{",content_css+=builder_css_generator(props),content_css+="}");return tb_css+td_css+content_css}(key,props,blockId,blockName);break;case"t_builder":css=function(key,props,blockId,isPrev){var w_selector=css_parent_selector(blockId,isPrev)+".thwecmf-main-builder",td_css="";-1!==$.inArray(key,["b_t","b_r","b_b","b_l","border_style","border_color","bg_color"])&&(td_css=w_selector+" .thwecmf-builder-column{",td_css+=builder_css_generator(props),td_css+="}");return td_css}(key,props,blockId,blockName);break;default:css=""}return css}function reset_sidebar_status($configure){var active,inactive,sidebar_nav=$("#thwecmf_header_sidebar_nav");$configure?(active="thwecmf-sidebar-configure",inactive="thwecmf-sidebar-settings",sidebar_nav.addClass("thwecmf-inactive-nav")):(active="thwecmf-sidebar-settings",inactive="thwecmf-sidebar-configure",sidebar_nav.removeClass("thwecmf-inactive-nav"));var block_id,builder_elm,panel_elm,settings_panel=$("#thwecmf-sidebar-element-wrapper");settings_panel.find("#"+active).removeClass("inactive-tab").addClass("thwecmf-active-tab"),settings_panel.find("#"+inactive).removeClass("thwecmf-active-tab").addClass("inactive-tab"),1==$("#thwecmf-sidebar-settings").find(".thwecmf-block-settings-form").length&&$configure&&(block_id=$("#thwecmf-sidebar-settings").find('input[name="i_thwecmf_block_id"]').val(),builder_elm=$("#tbf_"+block_id),panel_elm=$("#"+block_id),(builder_elm.hasClass("thwecmf-block")||builder_elm.hasClass("hook-code"))&&highlight_focus_blocks(builder_elm,panel_elm))}function setup_builder_ui(){setup_sortable_sidebar_blocks("div.thwecmf-builder-elm-layers",".thwecmf-sortable-row-handle",".thwecmf-rows",".thwecmf-element-set,.thwecmf-builder-elm-layers",sortable_start_handler,sortable_out_handler,sortable_stop_handler,null,sortable_receive_handler,sortable_update_handler),setup_sortable_sidebar_blocks("div.thwecmf-column-set",".sortable-col-handle","> div.thwecmf-columns","",sortable_start_handler,sortable_out_handler,sortable_stop_handler,null,null,sortable_update_handler),setup_sortable_sidebar_blocks("div.thwecmf-element-set",".sortable-elm-handle","div.thwecmf-hooks,div.thwecmf-elements:not(.panel-add-btn)",".thwecmf-element-set,div.thwecmf-builder-elm-layers",sortable_start_handler,sortable_out_handler,sortable_stop_handler,null,null,sortable_update_handler)}function setup_sortable_sidebar_blocks(elm,handle,items,connectWith,start_handler,out_handler,stop_handler,over_handler,receive_handler,update_handler){$(elm).sortable({handle:handle,axis:"x,y",items:items,scroll:!0,cursor:"move",helper:"clone",placeholder:"sortable-row-placeholder",connectWith:connectWith,forcePlaceholderSize:!0,start:start_handler,out:out_handler,over:over_handler,stop:stop_handler,receive:receive_handler,update:update_handler}),$(elm).disableSelection()}function sortable_start_handler(event,ui){BLOCK_DRAGG=ui.item.attr("class"),BLOCK_DRAGG=$.trim(BLOCK_DRAGG.replace("thwecmf-panel-builder-block","")),$(ui.helper).addClass("dragg"),"thwecmf-rows"==BLOCK_DRAGG?(ui.helper.find(".thwecmf-column-set").css("display","none"),ui.helper.css("height","unset")):"thwecmf-columns"==BLOCK_DRAGG?(ui.helper.find(".thwecmf-element-set").css("display","none"),ui.helper.css("height","unset"),ui.placeholder.addClass("ui-sortable-placeholder-columns")):"thwecmf-elements"!=BLOCK_DRAGG&&"thwecmf-hooks"!=BLOCK_DRAGG||ui.placeholder.addClass("ui-sortable-placeholder-element-hooks")}function sortable_out_handler(event,ui){var prev_parent_id;"thwecmf-rows"!=BLOCK_DRAGG&&"thwecmf-elements"!=BLOCK_DRAGG||0<ui.item.closest(".thwecmf-columns").length&&(prev_parent_id=ui.item.closest(".thwecmf-columns").attr("id"),ui.item.data("prev-parent",prev_parent_id))}function sortable_stop_handler(event,ui){$(ui.helper).removeClass("dragg"),$(this).hasClass("thwecmf-elements")&&ui.item.hasClass("thwecmf-elements")}function sortable_receive_handler(event,ui){!$(this).hasClass("thwecmf-builder-elm-layers")||"thwecmf-elements"!=BLOCK_DRAGG&&"thwecmf-hooks"!=BLOCK_DRAGG||(ui.placeholder.hide(),ui.sender.sortable("cancel"),alert("Cannot place an element outside a column"))}function sortable_update_handler(event,ui){var prev_parent,column_id,data,prev_parent_ref,track_id="tbf_"+ui.item.attr("id"),next_id=ui.item.next().attr("id"),prev_id=ui.item.prev().attr("id");prev_id?(prev_id="tbf_"+prev_id,$($("#tbf_t_builder").find("#"+track_id)).insertAfter($("#"+prev_id))):(next_id="tbf_"+next_id,$($("#tbf_t_builder").find("#"+track_id)).insertBefore($("#"+next_id))),0<ui.item.closest(".thwecmf-element-set").closest(".thwecmf-columns").length&&(prev_parent=ui.item.data("prev-parent"),ui.item.closest(".thwecmf-element-set").closest(".thwecmf-columns").attr("id"),track_id=ui.item.attr("id"),next_id=ui.item.next().attr("id"),prev_id=ui.item.prev().attr("id"),ui.item.closest(".thwecmf-columns").attr("id")&&(column_id=ui.item.closest(".thwecmf-columns").attr("id")),data=$("#tbf_t_builder").find("#tbf_"+track_id),prev_id?$(data).insertAfter($("#tbf_"+prev_id)):next_id?$(data).insertBefore($("#tbf_"+next_id)):next_id||prev_id||$("#tbf_t_builder").find("#tbf_"+column_id).html(data),(prev_parent_ref=$("#tbf_"+prev_parent)).find(".thwecmf-builder-block").length<1&&prev_parent_ref.find(".thwecmf-hook-code").length<1&&$("#tbf_"+prev_parent).html(EMPTY_TD_DATA))}function display_save_messages(msg,msg_class){var message_box=$("#thwecmf_builder_save_messages");message_box.html(msg).addClass("thwecmf-show-save thwecmf-save-"+msg_class),setTimeout(function(){message_box.removeClass("thwecmf-show-save thwecmf-save-"+msg_class)},3e3)}function template_preview_content(show_hooks){var elm,preview_html=$("#tbf_t_builder").clone(!0);(elm=preview_html).find("p.thwecmf-hook-code").each(function(index,el){$(this).removeAttr("id")}),elm.attr("id",elm.attr("id").replace("tbf_","tpf_")),elm.removeClass("thwecmf-dropable sortable ui-sortable ui-droppable"),elm.find(".thwecmf-icon-panel").remove(),elm.find(".thwecmf-columns .dashicons-edit").remove(),elm.find('input[type="hidden"]').remove(),elm.find(".thwecmf-columns").css("min-height","0"),elm.find(".ui-sortable").removeClass("ui-sortable ui-droppable"),preview_html.find(".thwecmf-btn-add-element").remove(),preview_html.find(".thwecmf-builder-block").each(function(index,el){var id,block_name=$(this).data("block-name");show_hooks&&function(block_elm,block_name){"billing_address"==block_name&&hook_position_manager(block_elm,"{billing_address}","thwecmf-billing-body",!1,!1);"shipping_address"==block_name&&(hook_position_manager(block_elm,"{shipping_address}","thwecmf-shipping-body",!1,!1),function($elm,$name){{var shipping_table;"thwecmf_shipping_address"==$name&&((shipping_table=$elm.find("> tbody > tr > td")).prepend("<span>{thwecmf_before_shipping_address}</span>"),shipping_table.append("<span>{thwecmf_after_shipping_address}</span>"))}}(block_elm,block_name))}($(this),block_name),$(this).attr("id")&&(id=(id=$(this).attr("id")).replace("tbf_","tpf_"),$(this).attr("id",id)),$(this).hasClass("thwecmf-row")&&$(this).find(" tbody> tr > .thwecmf-columns").each(function(index,el){var id=(id=$(this).attr("id")).replace("tbf_","tpf_");$(this).attr("id",id)})}),preview_html.find(".thwecmf-builder-block").removeClass("thwecmf-builder-block"),preview_html.find("[data-css-props]").each(function(index,el){$(this).removeAttr("data-css-props"),$(this).attr("data-text-props")&&$(this).removeAttr("data-text-props")}),preview_html.removeAttr("data-css-props"),preview_html.removeAttr("data-global-id"),preview_html.removeAttr("data-track-save"),preview_html.removeAttr("data-css-change"),$("#thwecmf_tbuilder_editor_preview").html(preview_html)}function hook_position_manager($obj,$hook_name,$class_name,$control,$position){var elm_blk=$obj.closest(".thwecmf-element-block"),elm_col=$obj.closest(".thwecmf-columns"),row_col=$obj.closest(".thwecmf_column_layout"),insert="";$control?(insert=elm_blk.siblings().length?elm_blk:elm_blk.closest(".thwecmf-column-padding").length?elm_col:row_col,$position?$("<span>"+$hook_name+"</span>").insertAfter(insert):$("<span>"+$hook_name+"</span>").insertBefore(insert)):$obj.find("."+$class_name).html("<span>"+$hook_name+"</span>")}return{render_edit_block_sidebar_form:render_edit_block_sidebar_form,setup_category_toggle:function(elm){$(elm);var click_cat=$(elm).closest(".grid-category");click_cat.hasClass("category-collapse")?(click_cat.removeClass("category-collapse"),$(".thwecmf-tbuilder-elm-grid-layout-element").find(".grid-category").not(click_cat).each(function(index,el){$(this).addClass("category-collapse")})):click_cat.addClass("category-collapse")},delete_builder_blocks:function(elm){var id,block,block_parent,delete_panel_elm,delete_id,builder_element,panel_element,builder_element_parent,panel_element_parent,columns,updated_columns;$(elm).closest("div.thwecmf-panel-builder-block").hasClass("thwecmf-hooks")?(id=$(elm).closest("div.thwecmf-panel-builder-block").attr("id"),$(elm).closest("div.thwecmf-panel-builder-block").remove(),block_parent=(block=$("#tbf_t_builder").find("#tbf_"+id)).closest(".thwecmf-columns"),block.remove(),block_parent.find(".thwecmf-builder-block").length<1&&block_parent.find(".thwecmf-hook-code").length<1&&block_parent.html(EMPTY_TD_DATA)):(delete_id=(delete_panel_elm=$(elm).closest("div.thwecmf-panel-builder-block")).attr("id"),builder_element=$("#tbf_t_builder").find("#tbf_"+delete_id),panel_element=$("div.thwecmf-builder-elm-layers").find("#"+delete_id),delete_panel_elm.hasClass("thwecmf-rows")||delete_panel_elm.hasClass("thwecmf-elements")?(builder_element_parent=builder_element.closest(".thwecmf-columns"),builder_element.remove(),panel_element.remove(),builder_element_parent.find(".thwecmf-builder-block").length<1&&builder_element_parent.find(".thwecmf-hook-code").length<1&&builder_element_parent.html(EMPTY_TD_DATA)):delete_panel_elm.hasClass("thwecmf-columns")&&(builder_element_parent=builder_element.closest(".thwecmf-row"),(columns=(panel_element_parent=panel_element.closest(".thwecmf-rows")).attr("data-columns"))<=1?(builder_element_parent.remove(),panel_element_parent.remove()):(updated_columns=parseInt(columns)-1,panel_element_parent.attr("data-columns",updated_columns),builder_element_parent.attr("data-column-count",updated_columns),builder_element.remove(),panel_element.remove(),function(row,columns){var col_width=100/parseInt(columns);$("#tbf_t_builder").find("#tbf_"+row+" tbody > tr > td").each(function(index,el){var block_id,data_props_json,data_props=$(this).attr("data-css-props");$(this).attr("id")&&(block_id=$(this).attr("id").replace("tbf_",""),data_props?(data_props=JSON.parse(data_props),0):data_props=DEF_COL_PROPS,data_props.width=col_width+"%",data_props_json=JSON.stringify(data_props),$(this).attr("data-css-props",data_props_json),prepare_builder_block_css(data_props,block_id,"column_clone"))})}(builder_element_parent.attr("id").replace("tbf_",""),updated_columns)))),setup_blank_sidebar_msg()},clear_tbuilder_sidebar:function(elm){var popup=$("#thwecmf_confirmation_alerts"),builder_css=$("#tbf_t_builder").attr("data-css-change");popup.find(".thwecmf-messages").html($("#thwecmf_clear_builder_confirm").html()),(1<$(".thwecmf-builder-elm-layers .thwecmf-panel-builder-block").length||"false"==builder_css)&&popup.dialog("open")},setup_wp_image_upload:function(elm,prop){var file_valid,validation_msg,frame=wp.media({title:"Upload Media Of Your Interest",button:{text:"Choose this"},multiple:!1});frame.open(),frame.on("select",function(){var thwecmf_attachment=frame.state().get("selection").first().toJSON();validation_msg="gif"==prop?(file_valid="image/gif"==thwecmf_attachment.mime,"<p>Invalid file type. Choose a Gif file</p>"):(file_valid="image"==thwecmf_attachment.type&&-1!==$.inArray(thwecmf_attachment.mime,UPLOAD_FILE_TYPES),"<p>Invalid file type. Choose an image file <br>[ jpg, jpeg, png ]</p>");var thwecmf_attachment_url=thwecmf_attachment.url,form_table=$("#thwecmf-sidebar-settings").find("form"),upload_block=form_table.find(".thwecmf-upload-action-settings.thwecmf-img-preview-"+prop);file_valid?("image"!=prop&&"gif"!=prop||(set_field_value(form_table,"text","upload_img_url",thwecmf_attachment_url,0),form_table.find('input[name="i_upload_img_url"]').trigger("keyup")),upload_block.find(".thwecmf-upload-preview img").attr("src",thwecmf_attachment_url),upload_block.find(".thwecmf-remove-upload-btn").hasClass("thwecmf-remove-upload-inactive")&&upload_block.find(".thwecmf-remove-upload-btn").removeClass("thwecmf-remove-upload-inactive"),upload_block.closest("td").find(".thwecmf-upload-notices").html("")):upload_block.closest("td").find(".thwecmf-upload-notices").html(validation_msg)})},add_row_builder_action:function(elm){reset_sidebar_status(!1),setup_sidebar_content("layout"),setup_sidebar_panel_scrolls(!1,!0,!1,!1)},template_sidebar_back_navigation:function(elm){$(elm).data("nav"),reset_sidebar_status(!0)},remove_image_uploaded:function(elm){var upload_pointer=$(elm),upload_preview=upload_pointer.siblings(".thwecmf-upload-preview"),default_url=upload_preview.attr("data-default-url");upload_preview.closest(".thwecmf-upload-action-settings").find(".thwecmf-upload-url").val(default_url).trigger("keyup"),upload_pointer.closest(".thwecmf-upload-action-settings").find(".thwecmf-upload-preview img").attr("src",default_url);var notice_tag=upload_pointer.closest(".thwecmf-upload-action-settings").siblings(".thwecmf-upload-notices");0<notice_tag.find("p").length&&notice_tag.find("p").remove(),upload_pointer.addClass("thwecmf-remove-upload-inactive")},click_test_mail_button:function(elm){var content=$("#thwecmf_modal_test_mail").html(),modal_box=$("#thwecmf_builder_header_action_box");remove_builder_panel_highlights(),modal_box.find(".content-box").html(content),modal_box.addClass("thwecmf-modal-active")},close_test_mail_box:function(elm){$(elm).closest(".thwecmf-test-mail-wrapper").removeClass("thwecmf-test-mail-active")},click_test_mail_action:function(elm){var test_mail_data,css,error_msgs,button=$(elm),mail_id=button.siblings('input[name="test_mail_input"]').val(),validation_box=button.closest(".thwecmf-test-mail-modal").siblings(".thwecmf-action-validation-box"),valid_result=function(mail_id){var validation_set={},error_msg=[],builder_valid=validation_set.valid=!0,email_valid=!0,split_pattern=mail_id.split("@");{var validation1,valid_split,validation21;split_pattern&&(split_pattern[0],""!=(validation1=split_pattern[1])&&null!=validation1?(valid_split=validation1.split("."),valid_split[0],null!=(validation21=valid_split[1])&&""!=validation21?email_valid=!0:(email_valid=!1,error_msg.push(TEST_MAIL_NOTICE))):(email_valid=!1,error_msg.push(TEST_MAIL_NOTICE)))}0==$("#tbf_t_builder").find(".thwecmf-builder-block").length&&(error_msg.push("Add contents to the builder"),builder_valid=!1);return validation_set.valid=!(!email_valid||!builder_valid),validation_set.errors=error_msg,validation_set}(mail_id);valid_result.valid?(validation_box.html(""),template_preview_content(!1),test_mail_data=$("#thwecmf_tbuilder_editor_preview").html(),css=$("#thwecmf_template_css").html(),function(mail_data,mail_css,mail_id,msg_box){var template_ajax_load=$("#thwecmf-ajax-load-modal"),test_data={thwecmf_security:thwecmf_admin_var.ajax_nonce,action:"thwecmf_template_actions",thwecmf_action_index:"settings",test_mail_data:mail_data,test_mail_css:mail_css,test_mail_id:mail_id};$.ajax({type:"POST",url:ajaxurl,data:test_data,beforeSend:function(){template_ajax_load.addClass("thwecmf-ajax-loading")},success:function(data){data&&msg_box.html(prepare_validation_html("Email sent successfully",!0))},complete:function(){template_ajax_load.removeClass("thwecmf-ajax-loading")},error:function(){alert("error")}})}(test_mail_data,css+=$("#thwecmf_template_css_preview_override").html(),mail_id,validation_box)):(error_msgs="",$.each(valid_result.errors,function(key,value){error_msgs+=prepare_validation_html(value,valid_result.valid)}),validation_box.html(error_msgs))},builder_prepare_save_template:function(elm){var layer_data,row_struct,row_array,json_tree=(layer_data=$(".thwecmf-tbuilder-elm-wrapper").find(".thwecmf-sidebar-config-elm-layers .thwecmf-builder-elm-layers"),row_struct={},row_array=[],layer_data.find("> .thwecmf-rows.thwecmf-panel-builder-block").each(function(index,el){var row_data={},col_array=[];$(this).find("> .thwecmf-column-set > .thwecmf-columns.thwecmf-panel-builder-block").each(function(index,el){var col_data={},elm_array=[];$(this).find("> .thwecmf-element-set > .thwecmf-panel-builder-block").each(function(index,el){var json_blk_id,json_blk_name,json_blk_obj,hook_names,elm_data={};$(this).hasClass("thwecmf-elements")?(json_blk_id=$(this).attr("id"),json_blk_name=$(this).find(".thwecmf-block-settings .thwecmf-template-action-edit").attr("data-icon-attr"),json_blk_obj=$("#tbf_"+json_blk_id),elm_data.data_id=json_blk_id,elm_data.data_type="element",elm_data.data_name=json_blk_name,elm_data.data_css=json_blk_obj.attr("data-css-props"),elm_data.data_text=json_blk_obj.attr("data-text-props"),elm_data.data_misc=is_content_inlcude_img(json_blk_name)?json_blk_obj.attr("data-misc"):"",elm_data.child=$(this).find(".thwecmf-element-name").text(),elm_array.push(elm_data)):$(this).hasClass("thwecmf-hooks")&&(elm_data.data_id=$(this).attr("id"),elm_data.data_type="hook",hook_names=(hook_names=$(this).find(".thwecmf-hook-name").text())+"_"+("Downloadable Product"==hook_names?"table":"hook"),elm_data.data_name=hook_names.toLowerCase().replace(/\s+/g,"_"),elm_data.child=$(this).find(".thwecmf-hook-name").text(),elm_array.push(elm_data))}),col_data.data_id=$(this).attr("id"),col_data.data_type="column",col_data.data_name=$(this).find(".thwecmf-block-settings .thwecmf-template-action-edit").attr("data-icon-attr"),col_data.data_css=$("#tbf_"+$(this).attr("id")).attr("data-css-props"),col_data.child=elm_array,col_array.push(col_data)}),row_data.data_id=$(this).attr("id"),row_data.data_type="row",row_data.data_name=$(this).find(".thwecmf-block-settings .thwecmf-template-action-edit").attr("data-icon-attr"),row_data.data_css=$("#tbf_"+$(this).attr("id")).attr("data-css-props"),row_data.data_text=$("#tbf_"+$(this).attr("id")).attr("data-text-props"),row_data.data_count=$("#tbf_"+$(this).attr("id")).attr("data-column-count"),row_data.child=col_array,row_array.push(row_data)}),row_struct.row=row_array,row_struct.data_id="t_builder",row_struct.data_type="builder",row_struct.track_save=$("#tbf_t_builder").attr("data-global-id"),row_struct.data_css=$("#tbf_t_builder").attr("data-css-props"),JSON.stringify(row_struct)),blank_builder_valid=!0,template_builder=$("#tbf_t_builder"),block_length=template_builder.find(".thwecmf-block").length,hook_length=template_builder.find(".thwecmf-hook-code").length,tname=$("#thwecmf_template_save_name").val(),tcss=($("#thwecmf_drag_n_drop").innerHTML,$("#thwecmf_template_css").html()),input_validation=function(tname,dependend){var validate=[],validation_set=[];return""==tname&&(validate.status=!1,validate.validate_flag="name",validate.message=dependend+" name is empty",validation_set.push(validate)),"Hook"==dependend?0==/^[a-zA-Z_]*$/.test(tname)&&(validate.status=!1,validate.validate_flag=!1,validate.message='Use only letters ([a-z],[A-Z]) and underscores ("_") for template name',validation_set.push(validate)):"Template"==dependend&&0==/^[a-zA-Z0-9-_ ]*$/.test(tname)&&(validate.status=!1,validate.validate_flag=!1,validate.message='Use only letters ([a-z],[A-Z]), digits ([0-9]), hyphen ("-") and underscores ("_") for template name',validation_set.push(validate)),validation_set}(tname,"Template"),template_name_valid=0===input_validation.length;(blank_builder_valid=0<block_length||0<hook_length)?template_name_valid?template_name_valid&&blank_builder_valid&&(template_builder.attr("data-track-save",template_builder.attr("data-global-id")),function(name,css,json_tree){$("#thwecmf_template_save_name").attr("value",$("#thwecmf_template_save_name").val()),template_preview_content(!0);var template_data=$("#thwecmf_tbuilder_editor_preview").html(),css_cleaned=css+$("#thwecmf_template_css_preview_override").html();!function(name,template_data,css_cleaned,json_tree){var template_ajax_load=$("#thwecmf-ajax-load-modal"),sample_data={thwecmf_security:thwecmf_admin_var.ajax_nonce,action:"thwecmf_template_actions",thwecmf_action_index:"settings",template_name:name,template_render_data:template_data,template_render_css:css_cleaned,template_json_tree:json_tree};$.ajax({type:"POST",url:ajaxurl,data:sample_data,beforeSend:function(){template_ajax_load.addClass("thwecmf-ajax-loading"),$("#thwecmf_builder_save_messages").html("").removeClass("thwecmf-show-save thwecmf-save-success")},success:function(data){var msg=data?"Template Saved":"Template was not Saved. Try again.",msg_class=data?"success":"error";$("#thwecmf_builder_save_messages").html(msg).addClass("thwecmf-show-save thwecmf-save-"+msg_class),setTimeout(function(){$("#thwecmf_builder_save_messages").removeClass("thwecmf-show-save thwecmf-save-"+msg_class)},3e3),display_save_messages(msg,msg_class)},complete:function(){template_ajax_load.removeClass("thwecmf-ajax-loading")},error:function(){display_save_messages("Something went wrong","error")}})}(name,template_data,css_cleaned,json_tree)}(tname,tcss,json_tree),template_builder.attr("data-css-change","true")):$.each(input_validation,function(key,value){value.status||alert(value.message)}):alert("Add elements to save the template")},edit_template_event_listner:function(elm){var template_to_edit=get_field_value($("#thwecmf_edit_template_form"),"select","edit_template");""==template_to_edit?(alert("Select a template to edit"),event.preventDefault()):-1==$.inArray(template_to_edit,WECMF_FREE_TEMP)?(alert("Cheating huh?"),event.preventDefault()):$('input[name="template_to_edit"]').val(template_to_edit)},template_map_validation:function(event,elm){return!1},map_form_toggle:function(elm){var button=$(elm),button_class=button.attr("class"),map_table=$("#wecmf_email_template_manager_table .thpladmin-form-email-notification-table");"thwecmf-close-all"==button_class?(map_table.find(".thwecmf-map-toggle-active").removeClass("thwecmf-map-toggle-active"),button.text("Expand all"),button.removeClass("thwecmf-close-all").addClass("thwecmf-open-all")):"thwecmf-open-all"==button_class&&(map_table.find(".template-map-single-row ").addClass("thwecmf-map-toggle-active"),button.text("Collpase all"),button.removeClass("thwecmf-open-all").addClass("thwecmf-close-all"))},close_modal:function(elm){$("#thwecmf_builder_header_action_box").removeClass("thwecmf-modal-active")},toggle_builder_preview_tab:function(elm){var tab_elm=$(elm),tab=tab_elm.data("tab"),active_tab_elm=tab_elm.closest(".thwecmf-header-icons").find(".active-tab"),active_tab=active_tab_elm.data("tab");if(remove_builder_panel_highlights(),tab!=active_tab){if("builder"==tab)$("#thwecmf-template-builder-wrapper").removeClass("thwecmf-preview-active"),$("#wpfooter").show(),$("#thwecmf_tbuilder_editor_preview").hide();else if("preview"==tab){if(!(0<$("#tbf_t_builder").find(".thwecmf-builder-block").length))return void alert("Nothing to Preview");$("#thwecmf-template-builder-wrapper").addClass("thwecmf-preview-active"),$("#wpfooter").hide(),$("#thwecmf_tbuilder_editor_preview").show(),template_preview_content(!1)}active_tab_elm.removeClass("active-tab"),tab_elm.addClass("active-tab")}}}}(window.jQuery,window,document);function thwecmfEditBuilderBlocks(elm,blockId,blockName){thwecmf_settings.render_edit_block_sidebar_form(elm,blockId,blockName)}function thwecmfClearTemplateBuilder(elm){thwecmf_settings.clear_tbuilder_sidebar(elm)}function thwecmfDeleteBuilderBlocks(elm){thwecmf_settings.delete_builder_blocks(elm)}function thwecmfUploadImage(elm,prop){thwecmf_settings.setup_wp_image_upload(elm,prop)}function thwecmfClickAddRow(elm){thwecmf_settings.add_row_builder_action(elm)}function thwecmfSidebarBackNavigation(elm){thwecmf_settings.template_sidebar_back_navigation(elm)}function thwecmfCollapseCategory(elm){thwecmf_settings.setup_category_toggle(elm)}function thwecmfRemoveImgUploaded(elm){thwecmf_settings.remove_image_uploaded(elm)}function thwecmfClickTestMail(elm){thwecmf_settings.click_test_mail_button(elm)}function thwecmfClickTestMailAction(elm){thwecmf_settings.click_test_mail_action(elm)}function thwecmfCloseTestMail(elm){thwecmf_settings.close_test_mail_box(elm)}function thwecmfSaveTemplate(elm){thwecmf_settings.builder_prepare_save_template(elm)}function thwecmfTemplateEditListner(elm){thwecmf_settings.edit_template_event_listner(elm)}function thwecmfTemplateMapValidation(elm){thwecmf_settings.template_map_validation(elm)}function thwecmfMapFormToggle(elm){thwecmf_settings.map_form_toggle(elm)}function thwecmfCloseModal(elm){thwecmf_settings.close_modal(elm)}function thwecBuilderPreviewTab(elm){thwecmf_settings.toggle_builder_preview_tab(elm)}