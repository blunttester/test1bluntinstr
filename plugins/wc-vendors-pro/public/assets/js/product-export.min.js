!function(i,d){function t(t){this.$form=t,this.xhr=!1,this.$form.find(".wcv-exporter-progress").val(0),this.processStep=this.processStep.bind(this),t.on("submit",{productExportForm:this},this.onSubmit),t.find(".wcv-exporter-types").on("change",{productExportForm:this},this.exportTypeFields)}t.prototype.onSubmit=function(t){t.preventDefault();var e=new Date,e="product-export-"+e.getDate()+"-"+(e.getMonth()+1)+"-"+e.getFullYear()+"-"+e.getTime()+".csv";t.data.productExportForm.$form.addClass("wcv-exporter_exporting"),t.data.productExportForm.$form.find(".wcv-exporter-progress").val(0),t.data.productExportForm.$form.find(".wcv-exporter-button").prop("disabled",!0),t.data.productExportForm.processStep(1,i(this).serialize(),"",e)},t.prototype.processStep=function(t,e,r,o){var p=this,s=i(".wcv-exporter-columns").val(),a=i("#wcv-exporter-meta:checked").length?1:0,c=i(".wcv-exporter-types").val(),n=i(".wcv-exporter-category").val();i.ajax({type:"POST",url:wcv_product_export_params.ajax_url,data:{form:e,action:"wcv_do_ajax_product_export",step:t,columns:r,selected_columns:s,export_meta:a,export_types:c,export_category:n,filename:o,security:wcv_product_export_params.export_nonce},dataType:"json",success:function(t){t.success&&("done"===t.data.step?(p.$form.find(".wcv-exporter-progress").val(t.data.percentage),d.location=t.data.url,setTimeout(function(){p.$form.removeClass("wcv-exporter__exporting"),p.$form.find(".wcv-exporter-button").prop("disabled",!1)},2e3)):(p.$form.find(".wcv-exporter-progress").val(t.data.percentage),p.processStep(parseInt(t.data.step,10),e,t.data.columns,o)))}}).fail(function(t){d.console.log(t)})},t.prototype.exportTypeFields=function(){var t=i(".wcv-exporter-category");-1!==i.inArray("variation",i(this).val())?t.closest("tr").hide():t.closest("tr").show()},i.fn.wcv_product_export_form=function(){return new t(this),this},i(".wcv-exporter").wcv_product_export_form()}(jQuery,window);