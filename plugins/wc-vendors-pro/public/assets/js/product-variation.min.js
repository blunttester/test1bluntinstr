jQuery(function(c){c(document).ready(function(){c("select.variation_actions").select2({placeholder:wcv_frontend_product_variation.variation_actions_placeholder,allowClear:!0})});var t={},n=[];c(".wcv_variations",c("#wcv_variable_product_options")).sortable({items:".wcv_variation",cursor:"move",axis:"y",handle:".wcv-sort",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,stop:function(){u.variation_row_indexes()}});var v=function(a,t,i,e){var n="attribute_"+a+"["+e+"]",o="variation_attribute "+a,r=c("<select></select>").attr("name",n).attr("class",o).data("taxonomy",a);return r.append('<option value="">'+wcv_frontend_product_variation.i18n_any_label+" "+i+"</option>"),c.each(t,function(a,t){r.append('<option value="'+a+'">'+t+"</option>")}),r},r=function(a,t,i){var e="default_attribute_"+a,n=a,o=c("<select></select>").attr("name",e).attr("class",n).data("current","").data("taxonomy",a);return o.append('<option value="">'+wcv_frontend_product_variation.i18n_any_label+" "+i+"</option>"),c.each(t,function(a,t){o.append('<option value="'+a+'">'+t+"</option>")}),o},s=function(a){var t=a;if(0<t.length){var i=t.val(),e=c("option",t),n=[];e.each(function(){n.push({val:c(this).val(),text:c(this).text()})}),n.sort(function(a,t){return a.val>t.val?1:a.val==t.val?0:-1});for(var o=0,r=n.length;o<r;o++)c(e[o]).val(n[o].val).text(n[o].text);return t.val(i),t}},l=function(){var n=c("#wcv-variation-attributes").data("variation_attr");c(".wcv_variation").each(function(){var a=c(this).find("select.variation_attribute");a.sort(function(a,t){var i=n[c(a).data("taxonomy")].position,e=n[c(t).data("taxonomy")].position;return e<i?1:i<e?-1:0}),a.detach().appendTo(c(this).find("span.variations_wrapper"))})},d=function(){var n=c("#wcv-variation-attributes").data("variation_attr"),a=c(".variation_default_values").find("select.default_attribute");a.sort(function(a,t){var i=n[c(a).data("taxonomy")].position,e=n[c(t).data("taxonomy")].position;return e<i?1:i<e?-1:0}),a.detach().appendTo(".variation_default_values")},u={init:function(){c("#wcv_variable_product_options").on("change","input.variable_is_downloadable",this.variable_is_downloadable).on("change","input.variable_is_virtual",this.variable_is_virtual).on("change","input.variable_manage_stock",this.variable_manage_stock).on("click","button.notice-dismiss",this.notice_dismiss).on("click","h5 .wcv-sort",this.set_menu_order).on("reload",this.reload),c("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock").change(),c(document.body).on("wcv_variations_added",this.variation_added)},reload:function(){p.load_variations(1),this.variation_options},variable_is_downloadable:function(){c(this).closest(".wcv_variation").find(".show_if_variation_downloadable").hide(),c(this).is(":checked")&&c(this).closest(".wcv_variation").find(".show_if_variation_downloadable").show()},variable_is_virtual:function(){c(this).closest(".wcv_variation").find(".hide_if_variation_virtual").show(),c(this).is(":checked")&&c(this).closest(".wcv_variation").find(".hide_if_variation_virtual").hide()},variable_manage_stock:function(){c(this).closest(".wcv_variation").find(".show_if_variation_manage_stock").hide(),c(this).closest(".wcv_variation").find(".hide_if_variation_manage_stock").show(),c(this).is(":checked")&&(c(this).closest(".wcv_variation").find(".show_if_variation_manage_stock").show(),c(this).closest(".wcv_variation").find(".hide_if_variation_manage_stock").hide())},notice_dismiss:function(){c(this).closest("div.notice").remove()},update_input:function(a,t){return c("."+t).val(a),!1},adjust_price:function(a,r,_){return c(".wcv_variation ."+a).each(function(a,t){var i=0,e=parseFloat(c(this).attr("value")),n=0;if((e.length<=0||isNaN(e))&&(e=0),0<=r.indexOf("%")){var o=(i=parseFloat(r.replace("%","")))/100*parseFloat(e);n="+"==_?parseFloat(e)+o:parseFloat(e)-o}else i=parseFloat(r),n="+"==_?parseFloat(e)+i:parseFloat(e)-i;(n<0||isNaN(n))&&(n=0),c(this).attr("value",n)}),!1},variations_loaded:function(a,t){t=t||!1;var i=c("#wcv_variable_product_options");t||(c("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock",i).change(),c(".wcv_variation",i).each(function(a,t){var i=c(t),e=c(".sale_price_dates_from",i).val(),n=c(".sale_price_dates_to",i).val();""===e&&""===n||c("a.sale_schedule",i).click()})),c(".wcv_variations",i).sortable({items:".wcv_variation",cursor:"move",axis:"y",handle:".wcv-sort",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,stop:function(){u.variation_row_indexes()}})},variation_added:function(a,t){1===t&&u.variations_loaded(null,!0)},set_menu_order:function(a){a.preventDefault();var t=c(this).closest(".wcv_variation").find(".variation_menu_order"),i=window.prompt(wcv_frontend_product_variation.i18n_enter_menu_order,t.val());null!=i&&(t.val(parseInt(i,10)).change(),p.save_variations())},variation_row_indexes:function(){var a=c("#wcv_variable_product_options").find(".wcv_variations"),t=parseInt(a.attr("data-page"),10),i=parseInt((t-1)*wcv_frontend_product_variation.variations_per_page,10);c(".wcv_variations .wcv_variation").each(function(a,t){c(".variation_menu_order",t).val(parseInt(c(t).index(".wcv_variations .wcv_variation"),10)+1+i).change()})}},o={setting_variation_image:null,init:function(){c("#wcv_variable_product_options").on("click",".upload_image_button",this.add_image)},add_image:function(a){var t,i,e=c(this),n=(e.attr("rel"),e.closest(".upload_image"));if(o.setting_variation_image=n,a.preventDefault(),e.is(".wcv_remove"))c(".upload_image_id",o.setting_variation_image).val("").change(),o.setting_variation_image.find("img").eq(0).attr("src",wcv_frontend_product_variation.wcv_woocommerce_placeholder_img_src),o.setting_variation_image.find(".upload_image_button").removeClass("wcv_remove");else{if(void 0!==t)return void t.open();(t=wp.media({title:wcv_frontend_product_variation.i18n_choose_image,button:{text:wcv_frontend_product_variation.i18n_set_image},states:[new wp.media.controller.Library({title:wcv_frontend_product_variation.i18n_choose_image,filterable:"all"})]})).on("select",function(){i=t.state().get("selection").first().toJSON(),c.trim(i.url.length)<0||(attachment_url=i.sizes.thumbnail?i.sizes.thumbnail.url:i.url,c(".upload_image_id",o.setting_variation_image).val(i.id).change(),o.setting_variation_image.find(".upload_image_button").addClass("wcv_remove"),o.setting_variation_image.find("img").eq(0).attr("src",attachment_url))}),t.open()}},restore_wp_media_post_id:function(){wp.media.model.settings.post.id=c("#post_id").val()}},p={init:function(){c("#wcv_variable_product_options").on("click",".remove_variation",this.remove_variation),c(document.body).on("change","#wcv_variable_product_options .wcv_variations :input",this.input_changed).on("change",".variations-defaults select",this.defaults_changed),c(".wcv-metaboxes-wrapper").on("change","select.variation_grouped_actions",function(){var a=c(this).attr("id");p.do_variation_action(a)}),c(".wcv-metaboxes-wrapper").on("click","a.do_variation_action",function(){p.do_variation_action("variation_actions_single")}),c("a.variations").on("click",this.check_for_attribute_changes),c(document).ready(function(){var a=c("#wcv-variation-attributes").data("variation_attr");c.isEmptyObject(n)&&(n=c.extend({},a))})},check_for_attribute_changes:function(){var e=c("#wcv-variation-attributes").data("variation_attr");if(c.isEmptyObject(n)&&(n=c.extend({},e)),JSON.stringify(n)!=JSON.stringify(e)){if(JSON.stringify(n).length==JSON.stringify(e).length)l(),d();else if(JSON.stringify(n).length>JSON.stringify(e).length)if(Object.keys(n).length==Object.keys(e).length)c.each(n,function(a,t){var i=_.omit(t.values,Object.keys(e[a].values));c.isEmptyObject(i)||p.update_variations_ui(a,i,"term","-")});else{var a=_.omit(n,Object.keys(e));c.each(a,function(a,t){p.update_variations_ui(a,t,"attribute","-"),p.update_defaults_ui(a,t,"attribute","-")})}else if(JSON.stringify(n).length<JSON.stringify(e).length)if(Object.keys(n).length==Object.keys(e).length)c.each(e,function(a,t){var i=_.omit(t.values,Object.keys(n[a].values));c.isEmptyObject(i)||p.update_variations_ui(a,i,"term","+")});else{var t=_.omit(e,Object.keys(n));c.each(t,function(a,t){p.update_variations_ui(a,t,"attribute","+"),p.update_defaults_ui(a,t,"attribute","+")})}n=jQuery.extend({},e)}jQuery.isEmptyObject(e)?(c(".variations-toolbar").hide(),c(".variations_notice").show()):(c(".variations-toolbar").show(),c(".variations_notice").hide()),p.check_total_variations()},update_variations_ui:function(n,o,r,_){c("#wcv-variation-attributes").data("variation_attr");p.block(),c(".wcv_variation").each(function(a,t){switch(r){case"attribute":if("-"==_)c(this).find("select."+n).remove();else{var i=v(n,o.values,o.label,a);c(this).find(".variation_title").append(i),l(),d()}break;case"term":if("-"==_){var e=c(this).find("select."+n);c.each(o,function(a,t){e.find('[value="'+a+'"]').remove()})}else{e=c(this).find("select."+n);c.each(o,function(a,t){e.append(c("<option></option>").attr("value",a).text(t))}),e=s(e)}}}),p.unblock()},update_defaults_ui:function(a,t,i,e){switch(i){case"attribute":if("-"==e)c(".variations-defaults").find("select."+a).remove();else{var n=r(a,t.values,t.label);c(".variation_default_values").append(n),l(),d()}break;case"term":if("-"==e){var o=c(this).find("select."+a);c.each(t,function(a,t){o.find('[value="'+a+'"]').remove()})}else{o=c(this).find("select."+a);c.each(t,function(a,t){o.append(c("<option></option>").attr("value",a).text(t))}),o=s(o)}}},check_total_variations:function(){return 0==c(".wcv_variation").length&&c(".variations-defaults").remove(),!1},block:function(){c("#wcv_variable_product_options").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){c("#wcv_variable_product_options").unblock()},load_default_attributes:function(){if(0==c(".wcv_variation").length){var a={action:"wcv_json_default_variation_attributes",attributes:c("#wcv-variation-attributes").data("variation_attr"),security:wcv_frontend_product_variation.wcv_add_variation_nonce};c.post(wcv_frontend_product_variation.ajax_url,a,function(a){var t=c(a);c(".toolbar-variations-defaults").prepend(t),c(".toolbar-variations-defaults").show()})}},add_variation:function(){p.block();var a={action:"wcv_json_add_variation",loop:c(".wcv_variation").length,parent_data:t,attributes:c("#wcv-variation-attributes").data("variation_attr"),security:wcv_frontend_product_variation.wcv_add_variation_nonce};return c.post(wcv_frontend_product_variation.ajax_url,a,function(a){var t=c(a);p.load_default_attributes(),c("#wcv_variable_product_options").find(".wcv_variations").prepend(t),c("#wcv_variable_product_options").trigger("wcv_variations_added",1),p.unblock()}),!1},remove_variation:function(){if(window.confirm(wcv_frontend_product_variation.i18n_remove_variation)){var a=c(this).parent().parent().parent().parent(),t=a.attr("rel"),i=a.data("loop");return a.remove(),p.add_deleted_variation(t,i),f.update_variations_count(-1),p.check_total_variations(),!1}},add_deleted_variation:function(a,t){if(0!=a){var i=c("#wcv_deleted_variations").data("variations"),e={};return jQuery.isEmptyObject(i)&&(i=[]),e.loop=t,e.id=a,i.push(e),c("#wcv_deleted_variations").data("variations",i),c("#wcv_deleted_variations").val(JSON.stringify(i)),!1}},delete_all_variations:function(){return c(".wcv_variation").each(function(){var a=c(this).attr("rel"),t=c(this).data("loop");c(this).remove(),p.add_deleted_variation(a,t),f.update_variations_count(-1),p.check_total_variations()}),!1},link_all_variations:function(){if(window.confirm(wcv_frontend_product_variation.i18n_link_all_variations)){p.block();var e=[],n=c(".wcv_variation").length;c(".wcv_variation").each(function(a,t){var i={};if(c(this).find(".variation_attribute").filter(function(){return""===this.value}).length)return!0;c(this).find(".variation_attribute").each(function(){i[c(this).attr("name").split("[")[0]]=c(this).val()}),e.push(i)});var a={action:"wcv_json_link_all_variations",parent_data:t,loop:c(".wcv_variation").length,attributes:c("#wcv-variation-attributes").data("variation_attr"),available_variations:e,security:wcv_frontend_product_variation.wcv_json_link_all_variations_nonce};return c.post(wcv_frontend_product_variation.ajax_url,a,function(a){var t=c(a);p.load_default_attributes(),c("#wcv_variable_product_options").find(".wcv_variations").prepend(t);var i=parseInt(c(".wcv_variation").length)-parseInt(n);1==i?window.alert(i+" "+wcv_frontend_product_variation.i18n_variation_added):0==i||1<i?window.alert(i+" "+wcv_frontend_product_variation.i18n_variations_added):window.alert(wcv_frontend_product_variation.i18n_no_variations_added),f.update_variations_count(i),p.unblock()}),!1}},input_changed:function(){c(this).closest(".wcv_variation").addClass("variation-needs-update"),c("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),c("#wcv_variable_product_options").trigger("wcv_variations_input_changed")},populate_parent:function(){t.title=c("#post_title").val(),t.sku=c("#_sku").val(),t.weight=c("#_weight").val(),t.length=c("#_length").val(),t.width=c("#_width").val(),t.height=c("#_height").val(),t.tax_status=c("#_tax_status").val()},defaults_changed:function(){c(this).closest("#wcv_variable_product_options").find(".wcv_variation:first").addClass("variation-needs-update"),c("#wcv_variable_product_options").trigger("wcv_variations_defaults_changed")},do_variation_action:function(a){var t,i=c("#"+a).val(),e={};if("-1"!=i)switch(p.populate_parent(),i){case"add_variation":return void p.add_variation();case"link_all_variations":return void p.link_all_variations();case"delete_all":window.confirm(wcv_frontend_product_variation.i18n_delete_all_variations)&&window.confirm(wcv_frontend_product_variation.i18n_last_warning)&&p.delete_all_variations();break;case"toggle_variable_enabled":case"toggle_variable_is_downloadable":case"toggle_variable_is_virtual":case"toggle_variable_manage_stock":var n=i.replace(/toggle_/,"");c("."+n).prop("checked",!c("."+n).prop("checked")),c("."+n).trigger("change");break;case"variable_regular_price_increase":case"variable_regular_price_decrease":case"variable_sale_price_increase":case"variable_sale_price_decrease":if(t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value_fixed_or_percent)){var o=-1<i.indexOf("increase")?"+":"-",r=-1<i.indexOf("increase")?i.substring(0,i.indexOf("_increase")):i.substring(0,i.indexOf("_decrease"));null!=t&&(t=0<=t.indexOf("%")?accounting.unformat(t.replace(/\%/,""),wcv_frontend_product_variation.mon_decimal_point)+"%":accounting.unformat(t,wcv_frontend_product_variation.mon_decimal_point)),u.adjust_price(r,String(t),o)}break;case"variable_regular_price":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),u.update_input(t,"variable_regular_price");break;case"variable_sale_price":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),u.update_input(t,"variable_sale_price");break;case"variable_stock":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),u.update_input(t,"variable_stock");break;case"variable_weight":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),u.update_input(t,"variable_weight");break;case"variable_length":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),u.update_input(t,"variable_length");break;case"variable_width":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),u.update_input(t,"variable_width");break;case"variable_height":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),u.update_input(t,"variable_height");break;case"variable_download_limit":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),u.update_input(t,"variable_download_limit");break;case"variable_download_expiry":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),u.update_input(t,"variable_download_expiry");break;case"variable_sale_schedule":date_from=window.prompt(wcv_frontend_product_variation.i18n_scheduled_sale_start),date_to=window.prompt(wcv_frontend_product_variation.i18n_scheduled_sale_end),null===date_from&&(date_from=!1),u.update_input(date_from,"sale_price_dates_from"),null===date_to&&(date_to=!1),u.update_input(date_to,"sale_price_dates_to");break;default:c("select#"+a).trigger(i),e=c("select#"+a).triggerHandler(i+"_ajax_data",e)}}},f={init:function(){c(document.body).on("wcv_variations_added",this.update_single_quantity)},update_variations_count:function(a){var t=c("#wcv_variable_product_options").find(".wcv_variations"),i=parseInt(t.attr("data-total"),10)+a,e=c(".variations-pagenav .displaying-num");return t.attr("data-total",i),1===i?e.text(wcv_frontend_product_variation.i18n_variation_count_single.replace("%qty%",i)):e.text(wcv_frontend_product_variation.i18n_variation_count_plural.replace("%qty%",i)),i},update_single_quantity:function(a,t){if(1===t){var i=c(".variations-pagenav");f.update_variations_count(t),i.is(":hidden")&&(c("option, optgroup",".variation_actions").show(),c(".variation_actions").val("add_variation"),c("#wcv_variable_product_options").find(".toolbar").show(),i.show(),c(".pagination-links",i).hide())}}};c(".wcv_product_variations").on("click","h5.variation_title",function(a){c(a.target).filter(":input, option, .wcv-sort").length||c(this).parent().parent().parent().find(".wcv-metabox-content").stop().slideToggle()}).on("click",".expand_all",function(){return c(this).closest(".wcv-metaboxes-wrapper").find(".wcv-metabox > .wcv-metabox-content").show(),!1}).on("click",".close_all",function(){return c(this).closest(".wcv-metaboxes-wrapper").find(".wcv-metabox > .wcv-metabox-content").hide(),!1}),c(".wcv_product_variations").on("click",".downloadable_files a.insert",function(){return c(this).closest(".downloadable_files").find("tbody").append(c(this).data("row")),!1}),c(".wcv_product_variations").on("click",".downloadable_files a.delete",function(){return c(this).closest("tr").remove(),!1}),c(".wcv_product_variations").on("click",".sale_schedule",function(){return c(".sale_price_dates_fields").show(),c(this).hide(),c(".cancel_sale_schedule").show(),!1}),c(".wcv_product_variations").on("click",".cancel_sale_schedule",function(){return c(".sale_price_dates_fields").hide(),c(this).hide(),c(".sale_schedule").show(),!1}),u.init(),o.init(),p.init(),f.init()});