window.TieredCommissions=window.TieredCommissions||{},function(e,u,t){var s={};t.init=function(){t.cache(),t.bindEvents(),u(e).ready(function(){t.ready()})},t.ready=function(){s.mainForm.parsley({excluded:"input[type=button], input[type=submit], input[type=reset], input[type=hidden], [disabled], :hidden, #_wc_booking_qty"}),t.checkCommissionTypes()},t.bindEvents=function(){s.addRowButton.on("click",t.addRowHandler),s.tableData.on("click",".delete-tier",t.removeRowHandler),s.tableData.on("change",t.checkCommissionTypes),s.tableData.on("change","input, select",t.highlightError),s.selector.on("change",t.cache),s.mainForm.on("submit",t.checkIfTableIsEmpty)},t.cache=function(){s.mainForm=u(".wcv_field"),s.tableData=u(".commission-tiers"),s.addRowButton=u(".insert-tier"),s.selector=u(t.getSelectorVar()),0===s.selector.length&&(s.selector=u("#wcvendors_commission_type")),s.tableId="#wcvendors_commission_tier_"+s.selector.val()+"_table"},t.randomColor=function(){return"#"+Math.random().toString(16).slice(2,8).toUpperCase()},t.checkCommissionTypesValues=function(e,r){switch(r){case"fixed":e.find(".percent, .fee").attr("disabled","disabled").attr("value",0),e.find(".amount").removeAttr("disabled");break;case"fixed_fee":e.find(".percent").attr("disabled","disabled").attr("value",0),e.find(".amount, .fee").removeAttr("disabled");break;case"percent":e.find(".amount, .fee").attr("disabled","disabled").attr("value",0),e.find(".percent").removeAttr("disabled");break;case"percent_fee":e.find(".amount").attr("disabled","disabled").attr("value",0),e.find(".percent, .fee").removeAttr("disabled");break;default:e.find(".amount, .fee, .percent").attr("disabled","disabled").attr("value",0)}},t.addRowHandler=function(e){e.preventDefault();e=u(this).data("row");u(s.tableId).find("tbody").append(e)},t.removeRowHandler=function(e){e.preventDefault(),confirm(commission_data.confirm_remove)&&u(this).closest("tr").remove()},t.checkCommissionTypes=function(){u(".commission-types").each(function(){var e=u(this).closest(".tier-row"),r=u(this).val();t.checkCommissionTypesValues(e,r)})},t.highlightError=function(){var o=u(this).closest(".tier-row"),a=o.find(".name").val(),d=o.find(".rule").val(),c=o.find(".value").val(),l=o.find(".amount").val(),m=o.find(".percent").val(),f=o.find(".fee").val(),p=["#e96868","#e74f4e","#d9321f","#c34242","#b23d3c","#a13736"];u(".tier-row").not(u(this)).each(function(){var e=u(this).find(".name").val(),r=u(this).find(".rule").val(),n=u(this).find(".value").val(),t=u(this).find(".amount").val(),s=u(this).find(".percent").val(),i=u(this).find(".fee").val();o.index()!=u(this).index()&&(a==e?(o.find(".name").css("border","1px solid "+p[0]).addClass("parsley-error"),u(this).find(".name").css("border","1px solid "+p[0])):(o.find(".name").css("border","none").removeClass("parsley-error"),u(this).find(".name").css("border","none").removeClass("parsley-error")),c==n&&d==r?(o.find(".value, .rule").css("border","1px solid "+p[1]).addClass("parsley-error"),u(this).find(".value, .rule").css("border","1px solid "+p[1]),u(this).find(".value, .rule").data("parsley-error-message",commission_data.possible_duplicate)):(o.find(".value, .rule").css("border","none").removeClass("parsley-error"),u(this).find(".value, .rule").css("border","none").removeClass("parsley-error")),0==t&&0==i&&0==s&&0==l&&0==f&&0==m?(o.find(".amount, .percent, .fee").css("border","1px solid "+p[2]),u(this).find(".amount, .percent, .fee").css("border","1px solid "+p[2]),u(this).find(".amount, .percent, .fee").data("parsley-error-message",commission_data.cant_be_zero)):(o.find(".amount, .percent, .fee").css("border","none").removeClass("parsley-error"),u(this).find(".amount, .percent, .fee").css("border","none").removeClass("parsley-error")),l==t&&f==i&&m==s?(o.find(".amount, .percent, .fee").css("border","1px solid "+p[3]),u(this).find(".amount, .percent, .fee").css("border","1px solid "+p[3]),u(this).find(".amount, .percent, .fee").data("parsley-error-message",commission_data.conflicting_rows)):(o.find(".amount, .percent, .fee").css("border","none").removeClass("parsley-error"),u(this).find(".amount, .percent, .fee").css("border","none").removeClass("parsley-error")))})},t.checkIfTableIsEmpty=function(e){var r=u(s.tableId+" >tbody >tr").length,n=s.selector.val();n&&-1!==["vendor_sales","product_sales","product_price"].indexOf(n)&&(0==r?(e.preventDefault(),alert(commission_data.cant_be_empty)):(u(s.tableId).find("input").removeAttr("disabled"),t.removeOtherTiers()))},t.getSelectorVar=function(){return u("#wcv_commission_type").length?"#wcv_commission_type":u("#_wcv_commission_type").length?"#_wcv_commission_type":void 0},t.removeOtherTiers=function(){var r=s.selector.val();["vendor_sales","product_sales","product_price"].forEach(function(e){e!=r&&u("#wcvendors_commission_tier_"+e).find(".commission-tiers").empty()})},u(t.init)}((window,document),jQuery,window.TieredCommissions);